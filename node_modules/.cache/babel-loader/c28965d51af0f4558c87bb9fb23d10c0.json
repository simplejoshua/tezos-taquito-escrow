{"ast":null,"code":"// Taken from https://github.com/WalletConnect/walletconnect-monorepo/blob/master/packages/qrcode-modal/src/browser.ts\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { windowRef } from '@airgap/beacon-core';\nimport { generateGUID } from '@airgap/beacon-utils';\nimport { alertTemplates } from './alert-templates';\nimport { preparePairingAlert } from './PairingAlert';\nimport { getColorMode } from '../../utils/colorMode';\nimport { createSanitizedElement } from '../../utils/html-elements';\nimport { constructDefaultAlert, constructPairAlert } from '../../utils/templates';\nlet lastFocusedElement;\nlet document;\n\nif (typeof window !== 'undefined' && typeof window.document !== 'undefined') {\n  document = window.document;\n}\n\nconst timeout = {};\n\nconst addQR = dataString => {\n  if (typeof dataString === 'string') {\n    return createSanitizedElement('div', [], [['id', 'beacon--qr__container']], [createSanitizedElement('div', [], [['id', 'beacon--qr__copy__container']], [createSanitizedElement('button', ['beacon-modal__button--outline'], [['id', 'beacon--qr__copy']], 'Copy')])]);\n  }\n\n  return createSanitizedElement('span', [], [], '');\n};\n\nconst formatAlert = (id, body, title, buttons, hasPairingPayload) => {\n  const callToAction = title;\n  const buttonsHtml = buttons.map((button, index) => createSanitizedElement('button', [`beacon-modal__button${button.style === 'outline' ? '--outline' : ''}`], [['id', `beacon-alert-${id}-${index}`]], button.text));\n  let allStyles = alertTemplates.default.css;\n\n  if (hasPairingPayload) {\n    allStyles += alertTemplates.pair.css;\n  }\n\n  const callToActionEl = createSanitizedElement('span', [], [], callToAction);\n  const alertEl = hasPairingPayload ? constructPairAlert(id, [callToActionEl], buttonsHtml, [body]) : constructDefaultAlert(id, [callToActionEl], buttonsHtml, [body]);\n  return {\n    style: allStyles,\n    html: alertEl\n  };\n};\n/**\n * Close an alert by ID\n *\n * @param id ID of alert\n */\n\n\nconst closeAlert = id => {\n  windowRef.postMessage(`closeAlert-${id}`);\n  return new Promise(resolve => {\n    var _a;\n\n    const wrapper = document.getElementById(`beacon-alert-wrapper-${id}`);\n\n    if (!wrapper) {\n      return resolve();\n    }\n\n    const elm = (_a = wrapper.shadowRoot) === null || _a === void 0 ? void 0 : _a.getElementById(`beacon-alert-modal-${id}`);\n\n    if (elm) {\n      const animationDuration = 300;\n      const localTimeout = timeout[id];\n\n      if (localTimeout) {\n        clearTimeout(localTimeout);\n        timeout[id] = undefined;\n      }\n\n      elm.className = elm.className.replace('fadeIn', 'fadeOut');\n      window.setTimeout(() => {\n        const parent = wrapper.parentNode;\n\n        if (parent) {\n          parent.removeChild(wrapper);\n        }\n\n        if (lastFocusedElement) {\n          ;\n          lastFocusedElement.focus(); // set focus back to last focussed element\n        }\n\n        resolve();\n      }, animationDuration);\n    } else {\n      resolve();\n    }\n  });\n};\n/**\n * Close all alerts\n */\n\n\nconst closeAlerts = () => __awaiter(void 0, void 0, void 0, function* () {\n  return new Promise(resolve => __awaiter(void 0, void 0, void 0, function* () {\n    const openAlertElements = document.querySelectorAll('[id^=\"beacon-alert-wrapper-\"]');\n\n    if (openAlertElements.length > 0) {\n      const alertIds = [];\n      openAlertElements.forEach(element => __awaiter(void 0, void 0, void 0, function* () {\n        alertIds.push(element.id.split('-')[3]);\n      }));\n      yield Promise.all(alertIds.map(closeAlert));\n      resolve();\n    } else {\n      resolve();\n    }\n  }));\n});\n/**\n * Show an alert\n *\n * @param alertConfig The configuration of the alert\n */\n// eslint-disable-next-line complexity\n\n\nconst openAlert = alertConfig => __awaiter(void 0, void 0, void 0, function* () {\n  var _a, _b;\n\n  const body = alertConfig.body;\n  const data = alertConfig.data;\n  const title = alertConfig.title;\n  const timer = alertConfig.timer;\n  const pairingPayload = alertConfig.pairingPayload;\n  const disclaimer = alertConfig.disclaimerText; // eslint-disable-next-line @typescript-eslint/unbound-method\n\n  const closeButtonCallback = alertConfig.closeButtonCallback;\n  yield closeAlerts();\n  const id = (yield generateGUID()).split('-').join('');\n  const shadowRootEl = document.createElement('div');\n  shadowRootEl.setAttribute('id', `beacon-alert-wrapper-${id}`);\n  const shadowRoot = shadowRootEl.attachShadow({\n    mode: 'open'\n  });\n  const wrapper = document.createElement('div');\n  wrapper.setAttribute('tabindex', `0`); // Make modal focussable\n\n  shadowRoot.appendChild(wrapper);\n  const buttons = [...((_b = (_a = alertConfig.buttons) === null || _a === void 0 ? void 0 : _a.map(button => {\n    var _a, _b;\n\n    return {\n      text: button.text,\n      // eslint-disable-next-line @typescript-eslint/unbound-method\n      actionCallback: (_a = button.actionCallback) !== null && _a !== void 0 ? _a : () => Promise.resolve(),\n      style: (_b = button.style) !== null && _b !== void 0 ? _b : 'outline'\n    };\n  })) !== null && _b !== void 0 ? _b : [])];\n  let formattedBody = pairingPayload ? addQR(body) : createSanitizedElement('span', [], [], body !== null && body !== void 0 ? body : '');\n\n  if (data) {\n    formattedBody = createSanitizedElement('span', [], [], [formattedBody, createSanitizedElement('pre', [], [['style', 'text-align: left']], data)]);\n  }\n\n  const {\n    style,\n    html\n  } = formatAlert(id, formattedBody, title, buttons, !!(pairingPayload === null || pairingPayload === void 0 ? void 0 : pairingPayload.p2pSyncCode));\n  wrapper.appendChild(html);\n  const styleEl = document.createElement('style');\n  styleEl.textContent = style;\n  shadowRoot.appendChild(styleEl);\n\n  if (timer) {\n    timeout[id] = window.setTimeout(() => __awaiter(void 0, void 0, void 0, function* () {\n      yield closeAlert(id);\n    }), timer);\n  }\n\n  document.body.prepend(shadowRootEl);\n  const closeButton = shadowRoot.getElementById(`beacon-alert-${id}-close`);\n\n  const closeButtonClick = () => __awaiter(void 0, void 0, void 0, function* () {\n    if (closeButtonCallback) {\n      closeButtonCallback();\n    }\n\n    yield closeAlert(id);\n  });\n\n  if (disclaimer) {\n    const disclaimerContainer = shadowRoot.getElementById(`beacon--disclaimer`);\n\n    if (disclaimerContainer) {\n      disclaimerContainer.innerText = disclaimer;\n    }\n  }\n\n  const colorMode = getColorMode();\n  const elm = shadowRoot.getElementById(`beacon-alert-modal-${id}`);\n\n  if (elm) {\n    elm.classList.add(`theme__${colorMode}`);\n    elm.addEventListener('click', closeButtonClick); // Backdrop click dismisses alert\n  }\n\n  const modal = shadowRoot.querySelectorAll('.beacon-modal__wrapper');\n\n  if (modal.length > 0) {\n    modal[0].addEventListener('click', event => {\n      event.stopPropagation();\n    });\n  }\n\n  lastFocusedElement = document.activeElement; // Store which element has been focussed before the alert is shown\n\n  wrapper.focus(); // Focus alert for accessibility\n\n  buttons.forEach((button, index) => {\n    const buttonElement = shadowRoot.getElementById(`beacon-alert-${id}-${index}`);\n\n    if (buttonElement) {\n      buttonElement.addEventListener('click', () => __awaiter(void 0, void 0, void 0, function* () {\n        yield closeAlert(id);\n\n        if (button.actionCallback) {\n          yield button.actionCallback();\n        }\n      }));\n    }\n  });\n\n  if (closeButton) {\n    closeButton.addEventListener('click', () => __awaiter(void 0, void 0, void 0, function* () {\n      yield closeButtonClick();\n    }));\n  }\n\n  window.addEventListener('keydown', event => __awaiter(void 0, void 0, void 0, function* () {\n    if (event.key === 'Escape') {\n      yield closeButtonClick();\n    }\n  }));\n\n  if (pairingPayload) {\n    yield preparePairingAlert(id, shadowRoot, pairingPayload);\n  }\n\n  return id;\n});\n\nexport { closeAlert, closeAlerts, openAlert };","map":{"version":3,"sources":["../../../../src/ui/alert/Alert.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["// Taken from https://github.com/WalletConnect/walletconnect-monorepo/blob/master/packages/qrcode-modal/src/browser.ts\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { windowRef } from '@airgap/beacon-core';\nimport { generateGUID } from '@airgap/beacon-utils';\nimport { alertTemplates } from './alert-templates';\nimport { preparePairingAlert } from './PairingAlert';\nimport { getColorMode } from '../../utils/colorMode';\nimport { createSanitizedElement } from '../../utils/html-elements';\nimport { constructDefaultAlert, constructPairAlert } from '../../utils/templates';\nlet lastFocusedElement;\nlet document;\nif (typeof window !== 'undefined' && typeof window.document !== 'undefined') {\n    document = window.document;\n}\nconst timeout = {};\nconst addQR = (dataString) => {\n    if (typeof dataString === 'string') {\n        return createSanitizedElement('div', [], [['id', 'beacon--qr__container']], [\n            createSanitizedElement('div', [], [['id', 'beacon--qr__copy__container']], [\n                createSanitizedElement('button', ['beacon-modal__button--outline'], [['id', 'beacon--qr__copy']], 'Copy')\n            ])\n        ]);\n    }\n    return createSanitizedElement('span', [], [], '');\n};\nconst formatAlert = (id, body, title, buttons, hasPairingPayload) => {\n    const callToAction = title;\n    const buttonsHtml = buttons.map((button, index) => createSanitizedElement('button', [`beacon-modal__button${button.style === 'outline' ? '--outline' : ''}`], [['id', `beacon-alert-${id}-${index}`]], button.text));\n    let allStyles = alertTemplates.default.css;\n    if (hasPairingPayload) {\n        allStyles += alertTemplates.pair.css;\n    }\n    const callToActionEl = createSanitizedElement('span', [], [], callToAction);\n    const alertEl = hasPairingPayload\n        ? constructPairAlert(id, [callToActionEl], buttonsHtml, [body])\n        : constructDefaultAlert(id, [callToActionEl], buttonsHtml, [body]);\n    return {\n        style: allStyles,\n        html: alertEl\n    };\n};\n/**\n * Close an alert by ID\n *\n * @param id ID of alert\n */\nconst closeAlert = (id) => {\n    windowRef.postMessage(`closeAlert-${id}`);\n    return new Promise((resolve) => {\n        var _a;\n        const wrapper = document.getElementById(`beacon-alert-wrapper-${id}`);\n        if (!wrapper) {\n            return resolve();\n        }\n        const elm = (_a = wrapper.shadowRoot) === null || _a === void 0 ? void 0 : _a.getElementById(`beacon-alert-modal-${id}`);\n        if (elm) {\n            const animationDuration = 300;\n            const localTimeout = timeout[id];\n            if (localTimeout) {\n                clearTimeout(localTimeout);\n                timeout[id] = undefined;\n            }\n            elm.className = elm.className.replace('fadeIn', 'fadeOut');\n            window.setTimeout(() => {\n                const parent = wrapper.parentNode;\n                if (parent) {\n                    parent.removeChild(wrapper);\n                }\n                if (lastFocusedElement) {\n                    ;\n                    lastFocusedElement.focus(); // set focus back to last focussed element\n                }\n                resolve();\n            }, animationDuration);\n        }\n        else {\n            resolve();\n        }\n    });\n};\n/**\n * Close all alerts\n */\nconst closeAlerts = () => __awaiter(void 0, void 0, void 0, function* () {\n    return new Promise((resolve) => __awaiter(void 0, void 0, void 0, function* () {\n        const openAlertElements = document.querySelectorAll('[id^=\"beacon-alert-wrapper-\"]');\n        if (openAlertElements.length > 0) {\n            const alertIds = [];\n            openAlertElements.forEach((element) => __awaiter(void 0, void 0, void 0, function* () {\n                alertIds.push(element.id.split('-')[3]);\n            }));\n            yield Promise.all(alertIds.map(closeAlert));\n            resolve();\n        }\n        else {\n            resolve();\n        }\n    }));\n});\n/**\n * Show an alert\n *\n * @param alertConfig The configuration of the alert\n */\n// eslint-disable-next-line complexity\nconst openAlert = (alertConfig) => __awaiter(void 0, void 0, void 0, function* () {\n    var _a, _b;\n    const body = alertConfig.body;\n    const data = alertConfig.data;\n    const title = alertConfig.title;\n    const timer = alertConfig.timer;\n    const pairingPayload = alertConfig.pairingPayload;\n    const disclaimer = alertConfig.disclaimerText;\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const closeButtonCallback = alertConfig.closeButtonCallback;\n    yield closeAlerts();\n    const id = (yield generateGUID()).split('-').join('');\n    const shadowRootEl = document.createElement('div');\n    shadowRootEl.setAttribute('id', `beacon-alert-wrapper-${id}`);\n    const shadowRoot = shadowRootEl.attachShadow({ mode: 'open' });\n    const wrapper = document.createElement('div');\n    wrapper.setAttribute('tabindex', `0`); // Make modal focussable\n    shadowRoot.appendChild(wrapper);\n    const buttons = [\n        ...((_b = (_a = alertConfig.buttons) === null || _a === void 0 ? void 0 : _a.map((button) => {\n            var _a, _b;\n            return ({\n                text: button.text,\n                // eslint-disable-next-line @typescript-eslint/unbound-method\n                actionCallback: (_a = button.actionCallback) !== null && _a !== void 0 ? _a : (() => Promise.resolve()),\n                style: (_b = button.style) !== null && _b !== void 0 ? _b : 'outline'\n            });\n        })) !== null && _b !== void 0 ? _b : [])\n    ];\n    let formattedBody = pairingPayload\n        ? addQR(body)\n        : createSanitizedElement('span', [], [], body !== null && body !== void 0 ? body : '');\n    if (data) {\n        formattedBody = createSanitizedElement('span', [], [], [formattedBody, createSanitizedElement('pre', [], [['style', 'text-align: left']], data)]);\n    }\n    const { style, html } = formatAlert(id, formattedBody, title, buttons, !!(pairingPayload === null || pairingPayload === void 0 ? void 0 : pairingPayload.p2pSyncCode));\n    wrapper.appendChild(html);\n    const styleEl = document.createElement('style');\n    styleEl.textContent = style;\n    shadowRoot.appendChild(styleEl);\n    if (timer) {\n        timeout[id] = window.setTimeout(() => __awaiter(void 0, void 0, void 0, function* () {\n            yield closeAlert(id);\n        }), timer);\n    }\n    document.body.prepend(shadowRootEl);\n    const closeButton = shadowRoot.getElementById(`beacon-alert-${id}-close`);\n    const closeButtonClick = () => __awaiter(void 0, void 0, void 0, function* () {\n        if (closeButtonCallback) {\n            closeButtonCallback();\n        }\n        yield closeAlert(id);\n    });\n    if (disclaimer) {\n        const disclaimerContainer = shadowRoot.getElementById(`beacon--disclaimer`);\n        if (disclaimerContainer) {\n            disclaimerContainer.innerText = disclaimer;\n        }\n    }\n    const colorMode = getColorMode();\n    const elm = shadowRoot.getElementById(`beacon-alert-modal-${id}`);\n    if (elm) {\n        elm.classList.add(`theme__${colorMode}`);\n        elm.addEventListener('click', closeButtonClick); // Backdrop click dismisses alert\n    }\n    const modal = shadowRoot.querySelectorAll('.beacon-modal__wrapper');\n    if (modal.length > 0) {\n        modal[0].addEventListener('click', (event) => {\n            event.stopPropagation();\n        });\n    }\n    lastFocusedElement = document.activeElement; // Store which element has been focussed before the alert is shown\n    wrapper.focus(); // Focus alert for accessibility\n    buttons.forEach((button, index) => {\n        const buttonElement = shadowRoot.getElementById(`beacon-alert-${id}-${index}`);\n        if (buttonElement) {\n            buttonElement.addEventListener('click', () => __awaiter(void 0, void 0, void 0, function* () {\n                yield closeAlert(id);\n                if (button.actionCallback) {\n                    yield button.actionCallback();\n                }\n            }));\n        }\n    });\n    if (closeButton) {\n        closeButton.addEventListener('click', () => __awaiter(void 0, void 0, void 0, function* () {\n            yield closeButtonClick();\n        }));\n    }\n    window.addEventListener('keydown', (event) => __awaiter(void 0, void 0, void 0, function* () {\n        if (event.key === 'Escape') {\n            yield closeButtonClick();\n        }\n    }));\n    if (pairingPayload) {\n        yield preparePairingAlert(id, shadowRoot, pairingPayload);\n    }\n    return id;\n});\nexport { closeAlert, closeAlerts, openAlert };\n//# sourceMappingURL=Alert.js.map"]},"metadata":{},"sourceType":"module"}