{"ast":null,"code":"/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { SimpleOuterSubscriber, innerSubscribe, SimpleInnerSubscriber } from '../innerSubscribe';\nexport function audit(durationSelector) {\n  return function auditOperatorFunction(source) {\n    return source.lift(new AuditOperator(durationSelector));\n  };\n}\n\nvar AuditOperator = /*@__PURE__*/function () {\n  function AuditOperator(durationSelector) {\n    this.durationSelector = durationSelector;\n  }\n\n  AuditOperator.prototype.call = function (subscriber, source) {\n    return source.subscribe(new AuditSubscriber(subscriber, this.durationSelector));\n  };\n\n  return AuditOperator;\n}();\n\nvar AuditSubscriber = /*@__PURE__*/function (_super) {\n  tslib_1.__extends(AuditSubscriber, _super);\n\n  function AuditSubscriber(destination, durationSelector) {\n    var _this = _super.call(this, destination) || this;\n\n    _this.durationSelector = durationSelector;\n    _this.hasValue = false;\n    return _this;\n  }\n\n  AuditSubscriber.prototype._next = function (value) {\n    this.value = value;\n    this.hasValue = true;\n\n    if (!this.throttled) {\n      var duration = void 0;\n\n      try {\n        var durationSelector = this.durationSelector;\n        duration = durationSelector(value);\n      } catch (err) {\n        return this.destination.error(err);\n      }\n\n      var innerSubscription = innerSubscribe(duration, new SimpleInnerSubscriber(this));\n\n      if (!innerSubscription || innerSubscription.closed) {\n        this.clearThrottle();\n      } else {\n        this.add(this.throttled = innerSubscription);\n      }\n    }\n  };\n\n  AuditSubscriber.prototype.clearThrottle = function () {\n    var _a = this,\n        value = _a.value,\n        hasValue = _a.hasValue,\n        throttled = _a.throttled;\n\n    if (throttled) {\n      this.remove(throttled);\n      this.throttled = undefined;\n      throttled.unsubscribe();\n    }\n\n    if (hasValue) {\n      this.value = undefined;\n      this.hasValue = false;\n      this.destination.next(value);\n    }\n  };\n\n  AuditSubscriber.prototype.notifyNext = function () {\n    this.clearThrottle();\n  };\n\n  AuditSubscriber.prototype.notifyComplete = function () {\n    this.clearThrottle();\n  };\n\n  return AuditSubscriber;\n}(SimpleOuterSubscriber);","map":{"version":3,"sources":["../../../src/internal/operators/audit.ts"],"names":[],"mappings":";AAKA,OAAO,KAAE,OAAT,MAAS,OAAT;AAgDA,SAAM,qBAAN,EAAyB,cAAzB,EAAmF,qBAAnF,QAAmF,mBAAnF;AACE,OAAA,SAAO,KAAP,CAAgB,gBAAhB,EAAgB;EACd,OAAA,SAAO,qBAAP,CAAuB,MAAvB,EAAqC;IACrC,OAAA,MAAA,CAAA,IAAA,CAAA,IAAA,aAAA,CAAA,gBAAA,CAAA,CAAA;EACH,CAFG;AAIJ;;IACE,aAAA,GAAA,aAAoB,YAA0D;EAA1D,SAAA,aAAA,CAAA,gBAAA,EAAA;IACnB,KAAA,gBAAA,GAAA,gBAAA;EAED;;EACE,aAAO,CAAA,SAAP,CAAc,IAAd,GAAwB,UAAI,UAAJ,EAA0B,MAA1B,EAAsC;IAC/D,OAAA,MAAA,CAAA,SAAA,CAAA,IAAA,eAAA,CAAA,UAAA,EAAA,KAAA,gBAAA,CAAA,CAAA;EACH,CAFI;;EAEH,OAAA,aAAA;AAOD,CAbsB,E;;IAac,eAAA,GAAA,aAAA,UAA2B,MAA3B,EAA2B;EAM7D,OAAA,CAAA,SAAA,CAAA,eAAA,EAAY,MAAZ;;EAAA,SAAA,eAAA,CAEE,WAFF,EAEQ,gBAFR,EAGC;IAFmB,IAAA,KAAA,GAAA,MAAA,CAAA,IAAA,CAAA,IAAA,EAAA,WAAA,KAA0D,IAA1D;;IAJZ,KAAA,CAAA,gBAAA,GAA0B,gBAA1B;;IAMP,OAAA,KAAA;EAED;;EACE,eAAU,CAAA,SAAV,CAAmB,KAAnB,GAAmB,UAAA,KAAA,EAAA;IACnB,KAAK,KAAL,GAAa,KAAb;IACA,KAAK,QAAL,GAAU,IAAV;;QACE,CAAA,KAAI,S,EAAQ;MACZ,IAAI,QAAA,GAAA,KAAA,CAAJ;;UACU;QACR,IAAA,gBAAW,GAAA,KAAiB,gBAA5B;QACD,QAAA,GAAA,gBAAA,CAAA,KAAA,CAAA;MAAC,C,CACA,OAAA,GAAA,EAAO;QACR,OAAA,KAAA,WAAA,CAAA,KAAA,CAAA,GAAA,CAAA;MACD;;MACA,IAAI,iBAAC,GAAiB,cAAI,CAAA,QAAA,EAAkB,IAAQ,qBAAR,CAAQ,IAAR,CAAlB,CAA1B;;UACE,CAAA,iBAAA,IAAqB,iBAAA,CAAA,M,EAAA;QACtB,KAAA,aAAA;MAAM,C,MACL;QACD,KAAA,GAAA,CAAA,KAAA,SAAA,GAAA,iBAAA;MACF;IACF;EAED,CAnBE;;EAoBM,eAAA,CAAA,SAAA,CAAE,aAAF,GAAS,YAAA;IACf,IAAI,EAAA,GAAA,IAAJ;IAAA,IAAe,KAAA,GAAA,EAAA,CAAA,KAAf;IAAA,IAAe,QAAA,GAAA,EAAA,CAAA,QAAf;IAAA,IAAe,SAAA,GAAA,EAAA,CAAA,SAAf;;QACE,S,EAAW;MACX,KAAK,MAAL,CAAK,SAAL;MACA,KAAA,SAAA,GAAU,SAAV;MACD,SAAA,CAAA,WAAA;IACD;;QACE,Q,EAAU;MACV,KAAK,KAAL,GAAa,SAAb;MACA,KAAK,QAAL,GAAgB,KAAhB;MACD,KAAA,WAAA,CAAA,IAAA,CAAA,KAAA;IACF;EAED,CAbQ;;EAcN,eAAK,CAAA,SAAL,CAAqB,UAArB,GAAqB,YAAA;IACtB,KAAA,aAAA;EAED,CAHE;;EAIA,eAAK,CAAA,SAAL,CAAqB,cAArB,GAAqB,YAAA;IACtB,KAAA,aAAA;EACH,CAFI;;EAlDgC,OAAA,eAAA;CAAA,C,qBAAA,C","sourcesContent":["/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { SimpleOuterSubscriber, innerSubscribe, SimpleInnerSubscriber } from '../innerSubscribe';\nexport function audit(durationSelector) {\n    return function auditOperatorFunction(source) {\n        return source.lift(new AuditOperator(durationSelector));\n    };\n}\nvar AuditOperator = /*@__PURE__*/ (function () {\n    function AuditOperator(durationSelector) {\n        this.durationSelector = durationSelector;\n    }\n    AuditOperator.prototype.call = function (subscriber, source) {\n        return source.subscribe(new AuditSubscriber(subscriber, this.durationSelector));\n    };\n    return AuditOperator;\n}());\nvar AuditSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(AuditSubscriber, _super);\n    function AuditSubscriber(destination, durationSelector) {\n        var _this = _super.call(this, destination) || this;\n        _this.durationSelector = durationSelector;\n        _this.hasValue = false;\n        return _this;\n    }\n    AuditSubscriber.prototype._next = function (value) {\n        this.value = value;\n        this.hasValue = true;\n        if (!this.throttled) {\n            var duration = void 0;\n            try {\n                var durationSelector = this.durationSelector;\n                duration = durationSelector(value);\n            }\n            catch (err) {\n                return this.destination.error(err);\n            }\n            var innerSubscription = innerSubscribe(duration, new SimpleInnerSubscriber(this));\n            if (!innerSubscription || innerSubscription.closed) {\n                this.clearThrottle();\n            }\n            else {\n                this.add(this.throttled = innerSubscription);\n            }\n        }\n    };\n    AuditSubscriber.prototype.clearThrottle = function () {\n        var _a = this, value = _a.value, hasValue = _a.hasValue, throttled = _a.throttled;\n        if (throttled) {\n            this.remove(throttled);\n            this.throttled = undefined;\n            throttled.unsubscribe();\n        }\n        if (hasValue) {\n            this.value = undefined;\n            this.hasValue = false;\n            this.destination.next(value);\n        }\n    };\n    AuditSubscriber.prototype.notifyNext = function () {\n        this.clearThrottle();\n    };\n    AuditSubscriber.prototype.notifyComplete = function () {\n        this.clearThrottle();\n    };\n    return AuditSubscriber;\n}(SimpleOuterSubscriber));\n//# sourceMappingURL=audit.js.map\n"]},"metadata":{},"sourceType":"module"}