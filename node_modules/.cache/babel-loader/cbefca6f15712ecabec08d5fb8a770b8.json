{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { Serializer, Logger, windowRef } from '@airgap/beacon-core';\nimport { generateGUID } from '@airgap/beacon-utils';\nimport { isAndroid, isIOS } from '../../utils/platform';\nimport { getQrData } from '../../utils/qr';\nimport { getTzip10Link } from '../../utils/get-tzip10-link';\nimport { closeAlerts } from './Alert';\nimport { Pairing, WalletType } from './Pairing';\nimport { createSanitizedElement, createSVGElement, createSVGPathElement, removeAllChildren } from '../../utils/html-elements';\nconst logger = new Logger('Alert');\nconst serializer = new Serializer();\nexport const preparePairingAlert = (id, shadowRoot, pairingPayload) => __awaiter(void 0, void 0, void 0, function* () {\n  const getInfo = () => __awaiter(void 0, void 0, void 0, function* () {\n    return Pairing.getPairingInfo(pairingPayload, (_walletType, _wallet, keepOpen) => __awaiter(void 0, void 0, void 0, function* () {\n      if (keepOpen) {\n        return;\n      }\n\n      yield closeAlerts();\n    }), () => __awaiter(void 0, void 0, void 0, function* () {\n      switchPlatform();\n    }));\n  });\n\n  const info = yield getInfo();\n  const container = shadowRoot.getElementById(`pairing-container`);\n\n  if (!container) {\n    throw new Error('container not found');\n  }\n\n  const buttonListWrapper = document.createElement('span');\n  container.appendChild(buttonListWrapper);\n  info.buttons.forEach(button => __awaiter(void 0, void 0, void 0, function* () {\n    const randomId = yield generateGUID();\n    const titleEl = createSanitizedElement('div', ['beacon-list__title'], [], button.title);\n    const buttonEl = createSanitizedElement('button', ['beacon-modal__button', 'connect__btn'], [], button.text);\n    const linkEl = document.createElement('a');\n    linkEl.id = `button_${randomId}`;\n    linkEl.appendChild(titleEl);\n    linkEl.appendChild(buttonEl);\n    buttonListWrapper.appendChild(linkEl);\n    const shadowButtonEl = shadowRoot.getElementById(linkEl.id);\n\n    if (shadowButtonEl) {\n      shadowButtonEl.addEventListener('click', () => __awaiter(void 0, void 0, void 0, function* () {\n        button.clickHandler();\n      }));\n    }\n  }));\n\n  const showWallet = (listEl, type, wallet) => {\n    const altTag = `Open in ${wallet.name}`;\n    const walletKey = wallet.key;\n    const logoEl = wallet.logo ? createSanitizedElement('div', [], [], [createSanitizedElement('img', ['beacon-selection__img'], [['src', wallet.logo]], '')]) : createSVGElement(['beacon-selection__img', 'svg-inline--fa', 'fa-wallet', 'fa-w-16'], [['aria-hidden', 'true'], ['focusable', 'false'], ['data-prefix', 'fas'], ['data-icon', 'wallet'], ['role', 'img'], ['xmlns', 'http://www.w3.org/2000/svg'], ['viewBox', '0 0 512 512'], ['style', 'enable-background:new 0 0 512 512;'], ['xml:space', 'preserve']], [createSVGPathElement([['d', 'M376.2,181H152.9c-5.2,0-9.4-4.2-9.4-9.4s4.2-9.4,9.4-9.4h225c5.2,0,9.4-4.2,9.4-9.4c0-15.5-12.6-28.1-28.1-28.1H143.5c-20.7,0-37.5,16.8-37.5,37.5v187.5c0,20.7,16.8,37.5,37.5,37.5h232.7c16.4,0,29.8-12.6,29.8-28.1v-150C406,193.6,392.7,181,376.2,181z M349.8,302.9c-10.4,0-18.8-8.4-18.8-18.8s8.4-18.8,18.8-18.8s18.8,8.4,18.8,18.8S360.1,302.9,349.8,302.9z']])]);\n    const nameEl = createSanitizedElement('div', ['beacon-selection__name'], [], [createSanitizedElement('span', [], [], wallet.name), wallet.enabled ? undefined : createSanitizedElement('p', [], [], 'Not installed')]);\n    const linkEl = createSanitizedElement('a', ['beacon-selection__list', wallet.enabled ? '' : 'disabled'], [['tabindex', '0'], ['id', `wallet_${walletKey}`], ['alt', altTag], ['target', '_blank']], [nameEl, logoEl]);\n    const el = document.createElement('span');\n    el.appendChild(linkEl);\n    listEl.appendChild(el);\n    const walletEl = shadowRoot.getElementById(`wallet_${walletKey}`);\n\n    const completeHandler = event => __awaiter(void 0, void 0, void 0, function* () {\n      if (event && event.key !== 'Enter') {\n        return;\n      }\n\n      wallet.clickHandler();\n      const modalEl = shadowRoot.getElementById('beacon-modal__content');\n\n      if (modalEl && type !== WalletType.EXTENSION && type !== WalletType.IOS) {\n        removeAllChildren(modalEl);\n        modalEl.appendChild(createSanitizedElement('p', ['beacon-alert__title'], [], 'Establishing Connection..'));\n        modalEl.appendChild(createSanitizedElement('div', ['progress-line'], [['id', 'beacon-toast-loader']], ''));\n        modalEl.appendChild(createSanitizedElement('div', ['beacon--selected__container'], [], [...(wallet.logo ? [createSanitizedElement('img', ['beacon-selection__img'], [['src', wallet.logo]], ''), createSanitizedElement('img', ['beacon--selection__name__lg'], [], wallet.name)] : [])]));\n      }\n    });\n\n    if (walletEl) {\n      walletEl.addEventListener('click', () => completeHandler());\n      walletEl.addEventListener('keydown', completeHandler);\n    }\n  };\n\n  const listContainer = document.createElement('span');\n  container.appendChild(listContainer);\n\n  const showWalletLists = walletLists => {\n    removeAllChildren(listContainer);\n    walletLists.forEach(list => {\n      const listWrapperEl = document.createElement('div');\n      listWrapperEl.classList.add('beacon-list__wrapper');\n      listContainer.appendChild(listWrapperEl);\n      listWrapperEl.appendChild(createSanitizedElement('div', ['beacon-list__title'], [], list.title));\n      const listEl = document.createElement('span');\n      listWrapperEl.appendChild(listEl);\n      list.wallets.forEach(wallet => __awaiter(void 0, void 0, void 0, function* () {\n        showWallet(listEl, list.type, wallet);\n      }));\n    });\n  };\n\n  showWalletLists(info.walletLists); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n  const messageFn = event => __awaiter(void 0, void 0, void 0, function* () {\n    if (event.data === 'extensionsUpdated') {\n      const newInfo = yield getInfo();\n      showWalletLists(newInfo.walletLists);\n    }\n  }); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  let closeFn; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n  closeFn = event => {\n    if (event.data === `closeAlert-${id}`) {\n      windowRef.removeEventListener('message', messageFn);\n      windowRef.removeEventListener('message', closeFn);\n    }\n  };\n\n  windowRef.addEventListener('message', messageFn);\n  windowRef.addEventListener('message', closeFn);\n  const qr = shadowRoot.getElementById(`beacon--qr__container`);\n  const copyButton = shadowRoot.getElementById(`beacon--qr__copy`);\n  const titleEl = shadowRoot.getElementById(`beacon-title`);\n  const platform = isAndroid(window) ? 'android' : isIOS(window) ? 'ios' : 'desktop';\n  const mainText = shadowRoot.getElementById(`beacon-main-text`);\n  const walletList = shadowRoot.getElementById(`pairing-container`);\n  const switchButton = shadowRoot.getElementById(`beacon--switch__container`); // if (mainText && walletList && switchButton && copyButton && qr && titleEl) {\n\n  const clipboardFn = () => __awaiter(void 0, void 0, void 0, function* () {\n    const code = pairingPayload ? yield serializer.serialize(yield pairingPayload.p2pSyncCode()) : '';\n    navigator.clipboard.writeText(code).then(() => {\n      if (copyButton) {\n        copyButton.innerText = 'Copied';\n      }\n\n      logger.log('Copying to clipboard was successful!');\n    }, err => {\n      logger.error('Could not copy text to clipboard: ', err);\n    });\n  });\n\n  let qrShown = false;\n\n  const showPlatform = type => __awaiter(void 0, void 0, void 0, function* () {\n    const platformSwitch = shadowRoot.getElementById(`beacon-switch`);\n\n    if (platformSwitch) {\n      platformSwitch.innerText = type === 'none' ? 'Pair wallet on same device' : 'Pair wallet on another device';\n    }\n\n    if (mainText && walletList && switchButton && copyButton && qr && titleEl) {\n      mainText.style.display = 'none';\n      titleEl.style.textAlign = 'center';\n      walletList.style.display = 'none';\n      switchButton.style.display = 'initial';\n\n      switch (type) {\n        case 'ios':\n          walletList.style.display = 'initial';\n          break;\n\n        case 'android':\n          walletList.style.display = 'initial';\n          break;\n\n        case 'desktop':\n          walletList.style.display = 'initial';\n          titleEl.style.textAlign = 'left';\n          mainText.style.display = 'none';\n          switchButton.style.display = 'initial';\n          break;\n\n        default:\n          if (!qrShown) {\n            // If we have previously triggered the load, do not load it again (this can lead to multiple QRs being added if \"pairingPayload.p2pSyncCode()\" is slow)\n            qrShown = true;\n            const code = yield serializer.serialize(yield pairingPayload.p2pSyncCode());\n            const uri = getTzip10Link('tezos://', code);\n            const qrSVG = getQrData(uri, 'svg');\n            const qrString = qrSVG.replace('<svg', `<svg class=\"beacon-alert__image\"`);\n            qr.insertAdjacentHTML('afterbegin', qrString);\n\n            if (copyButton) {\n              copyButton.addEventListener('click', clipboardFn);\n            }\n\n            if (qr) {\n              qr.addEventListener('click', clipboardFn);\n            }\n          } // QR code\n\n\n          mainText.style.display = 'initial';\n      }\n    }\n  });\n\n  let showQr = false;\n\n  const switchPlatform = () => {\n    showPlatform(showQr ? 'none' : platform);\n    showQr = !showQr;\n  };\n\n  switchPlatform();\n  {\n    const platformSwitch = shadowRoot.getElementById(`beacon-switch`);\n\n    if (platformSwitch) {\n      platformSwitch.addEventListener('click', switchPlatform);\n    }\n  }\n});","map":{"version":3,"sources":["../../../../src/ui/alert/PairingAlert.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { Serializer, Logger, windowRef } from '@airgap/beacon-core';\nimport { generateGUID } from '@airgap/beacon-utils';\nimport { isAndroid, isIOS } from '../../utils/platform';\nimport { getQrData } from '../../utils/qr';\nimport { getTzip10Link } from '../../utils/get-tzip10-link';\nimport { closeAlerts } from './Alert';\nimport { Pairing, WalletType } from './Pairing';\nimport { createSanitizedElement, createSVGElement, createSVGPathElement, removeAllChildren } from '../../utils/html-elements';\nconst logger = new Logger('Alert');\nconst serializer = new Serializer();\nexport const preparePairingAlert = (id, shadowRoot, pairingPayload) => __awaiter(void 0, void 0, void 0, function* () {\n    const getInfo = () => __awaiter(void 0, void 0, void 0, function* () {\n        return Pairing.getPairingInfo(pairingPayload, (_walletType, _wallet, keepOpen) => __awaiter(void 0, void 0, void 0, function* () {\n            if (keepOpen) {\n                return;\n            }\n            yield closeAlerts();\n        }), () => __awaiter(void 0, void 0, void 0, function* () {\n            switchPlatform();\n        }));\n    });\n    const info = yield getInfo();\n    const container = shadowRoot.getElementById(`pairing-container`);\n    if (!container) {\n        throw new Error('container not found');\n    }\n    const buttonListWrapper = document.createElement('span');\n    container.appendChild(buttonListWrapper);\n    info.buttons.forEach((button) => __awaiter(void 0, void 0, void 0, function* () {\n        const randomId = yield generateGUID();\n        const titleEl = createSanitizedElement('div', ['beacon-list__title'], [], button.title);\n        const buttonEl = createSanitizedElement('button', ['beacon-modal__button', 'connect__btn'], [], button.text);\n        const linkEl = document.createElement('a');\n        linkEl.id = `button_${randomId}`;\n        linkEl.appendChild(titleEl);\n        linkEl.appendChild(buttonEl);\n        buttonListWrapper.appendChild(linkEl);\n        const shadowButtonEl = shadowRoot.getElementById(linkEl.id);\n        if (shadowButtonEl) {\n            shadowButtonEl.addEventListener('click', () => __awaiter(void 0, void 0, void 0, function* () {\n                button.clickHandler();\n            }));\n        }\n    }));\n    const showWallet = (listEl, type, wallet) => {\n        const altTag = `Open in ${wallet.name}`;\n        const walletKey = wallet.key;\n        const logoEl = wallet.logo\n            ? createSanitizedElement('div', [], [], [createSanitizedElement('img', ['beacon-selection__img'], [['src', wallet.logo]], '')])\n            : createSVGElement(['beacon-selection__img', 'svg-inline--fa', 'fa-wallet', 'fa-w-16'], [\n                ['aria-hidden', 'true'],\n                ['focusable', 'false'],\n                ['data-prefix', 'fas'],\n                ['data-icon', 'wallet'],\n                ['role', 'img'],\n                ['xmlns', 'http://www.w3.org/2000/svg'],\n                ['viewBox', '0 0 512 512'],\n                ['style', 'enable-background:new 0 0 512 512;'],\n                ['xml:space', 'preserve']\n            ], [\n                createSVGPathElement([\n                    [\n                        'd',\n                        'M376.2,181H152.9c-5.2,0-9.4-4.2-9.4-9.4s4.2-9.4,9.4-9.4h225c5.2,0,9.4-4.2,9.4-9.4c0-15.5-12.6-28.1-28.1-28.1H143.5c-20.7,0-37.5,16.8-37.5,37.5v187.5c0,20.7,16.8,37.5,37.5,37.5h232.7c16.4,0,29.8-12.6,29.8-28.1v-150C406,193.6,392.7,181,376.2,181z M349.8,302.9c-10.4,0-18.8-8.4-18.8-18.8s8.4-18.8,18.8-18.8s18.8,8.4,18.8,18.8S360.1,302.9,349.8,302.9z'\n                    ]\n                ])\n            ]);\n        const nameEl = createSanitizedElement('div', ['beacon-selection__name'], [], [\n            createSanitizedElement('span', [], [], wallet.name),\n            wallet.enabled ? undefined : createSanitizedElement('p', [], [], 'Not installed')\n        ]);\n        const linkEl = createSanitizedElement('a', ['beacon-selection__list', wallet.enabled ? '' : 'disabled'], [\n            ['tabindex', '0'],\n            ['id', `wallet_${walletKey}`],\n            ['alt', altTag],\n            ['target', '_blank']\n        ], [nameEl, logoEl]);\n        const el = document.createElement('span');\n        el.appendChild(linkEl);\n        listEl.appendChild(el);\n        const walletEl = shadowRoot.getElementById(`wallet_${walletKey}`);\n        const completeHandler = (event) => __awaiter(void 0, void 0, void 0, function* () {\n            if (event && event.key !== 'Enter') {\n                return;\n            }\n            wallet.clickHandler();\n            const modalEl = shadowRoot.getElementById('beacon-modal__content');\n            if (modalEl && type !== WalletType.EXTENSION && type !== WalletType.IOS) {\n                removeAllChildren(modalEl);\n                modalEl.appendChild(createSanitizedElement('p', ['beacon-alert__title'], [], 'Establishing Connection..'));\n                modalEl.appendChild(createSanitizedElement('div', ['progress-line'], [['id', 'beacon-toast-loader']], ''));\n                modalEl.appendChild(createSanitizedElement('div', ['beacon--selected__container'], [], [\n                    ...(wallet.logo\n                        ? [\n                            createSanitizedElement('img', ['beacon-selection__img'], [['src', wallet.logo]], ''),\n                            createSanitizedElement('img', ['beacon--selection__name__lg'], [], wallet.name)\n                        ]\n                        : [])\n                ]));\n            }\n        });\n        if (walletEl) {\n            walletEl.addEventListener('click', () => completeHandler());\n            walletEl.addEventListener('keydown', completeHandler);\n        }\n    };\n    const listContainer = document.createElement('span');\n    container.appendChild(listContainer);\n    const showWalletLists = (walletLists) => {\n        removeAllChildren(listContainer);\n        walletLists.forEach((list) => {\n            const listWrapperEl = document.createElement('div');\n            listWrapperEl.classList.add('beacon-list__wrapper');\n            listContainer.appendChild(listWrapperEl);\n            listWrapperEl.appendChild(createSanitizedElement('div', ['beacon-list__title'], [], list.title));\n            const listEl = document.createElement('span');\n            listWrapperEl.appendChild(listEl);\n            list.wallets.forEach((wallet) => __awaiter(void 0, void 0, void 0, function* () {\n                showWallet(listEl, list.type, wallet);\n            }));\n        });\n    };\n    showWalletLists(info.walletLists);\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const messageFn = (event) => __awaiter(void 0, void 0, void 0, function* () {\n        if (event.data === 'extensionsUpdated') {\n            const newInfo = yield getInfo();\n            showWalletLists(newInfo.walletLists);\n        }\n    });\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    let closeFn;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    closeFn = (event) => {\n        if (event.data === `closeAlert-${id}`) {\n            windowRef.removeEventListener('message', messageFn);\n            windowRef.removeEventListener('message', closeFn);\n        }\n    };\n    windowRef.addEventListener('message', messageFn);\n    windowRef.addEventListener('message', closeFn);\n    const qr = shadowRoot.getElementById(`beacon--qr__container`);\n    const copyButton = shadowRoot.getElementById(`beacon--qr__copy`);\n    const titleEl = shadowRoot.getElementById(`beacon-title`);\n    const platform = isAndroid(window) ? 'android' : isIOS(window) ? 'ios' : 'desktop';\n    const mainText = shadowRoot.getElementById(`beacon-main-text`);\n    const walletList = shadowRoot.getElementById(`pairing-container`);\n    const switchButton = shadowRoot.getElementById(`beacon--switch__container`);\n    // if (mainText && walletList && switchButton && copyButton && qr && titleEl) {\n    const clipboardFn = () => __awaiter(void 0, void 0, void 0, function* () {\n        const code = pairingPayload\n            ? yield serializer.serialize(yield pairingPayload.p2pSyncCode())\n            : '';\n        navigator.clipboard.writeText(code).then(() => {\n            if (copyButton) {\n                copyButton.innerText = 'Copied';\n            }\n            logger.log('Copying to clipboard was successful!');\n        }, (err) => {\n            logger.error('Could not copy text to clipboard: ', err);\n        });\n    });\n    let qrShown = false;\n    const showPlatform = (type) => __awaiter(void 0, void 0, void 0, function* () {\n        const platformSwitch = shadowRoot.getElementById(`beacon-switch`);\n        if (platformSwitch) {\n            platformSwitch.innerText =\n                type === 'none' ? 'Pair wallet on same device' : 'Pair wallet on another device';\n        }\n        if (mainText && walletList && switchButton && copyButton && qr && titleEl) {\n            mainText.style.display = 'none';\n            titleEl.style.textAlign = 'center';\n            walletList.style.display = 'none';\n            switchButton.style.display = 'initial';\n            switch (type) {\n                case 'ios':\n                    walletList.style.display = 'initial';\n                    break;\n                case 'android':\n                    walletList.style.display = 'initial';\n                    break;\n                case 'desktop':\n                    walletList.style.display = 'initial';\n                    titleEl.style.textAlign = 'left';\n                    mainText.style.display = 'none';\n                    switchButton.style.display = 'initial';\n                    break;\n                default:\n                    if (!qrShown) {\n                        // If we have previously triggered the load, do not load it again (this can lead to multiple QRs being added if \"pairingPayload.p2pSyncCode()\" is slow)\n                        qrShown = true;\n                        const code = yield serializer.serialize(yield pairingPayload.p2pSyncCode());\n                        const uri = getTzip10Link('tezos://', code);\n                        const qrSVG = getQrData(uri, 'svg');\n                        const qrString = qrSVG.replace('<svg', `<svg class=\"beacon-alert__image\"`);\n                        qr.insertAdjacentHTML('afterbegin', qrString);\n                        if (copyButton) {\n                            copyButton.addEventListener('click', clipboardFn);\n                        }\n                        if (qr) {\n                            qr.addEventListener('click', clipboardFn);\n                        }\n                    }\n                    // QR code\n                    mainText.style.display = 'initial';\n            }\n        }\n    });\n    let showQr = false;\n    const switchPlatform = () => {\n        showPlatform(showQr ? 'none' : platform);\n        showQr = !showQr;\n    };\n    switchPlatform();\n    {\n        const platformSwitch = shadowRoot.getElementById(`beacon-switch`);\n        if (platformSwitch) {\n            platformSwitch.addEventListener('click', switchPlatform);\n        }\n    }\n});\n//# sourceMappingURL=PairingAlert.js.map"]},"metadata":{},"sourceType":"module"}