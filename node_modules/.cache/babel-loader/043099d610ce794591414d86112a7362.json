{"ast":null,"code":"/** PURE_IMPORTS_START tslib,_Subscription,_innerSubscribe PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subscription } from '../Subscription';\nimport { SimpleOuterSubscriber, innerSubscribe, SimpleInnerSubscriber } from '../innerSubscribe';\nexport function bufferWhen(closingSelector) {\n  return function (source) {\n    return source.lift(new BufferWhenOperator(closingSelector));\n  };\n}\n\nvar BufferWhenOperator = /*@__PURE__*/function () {\n  function BufferWhenOperator(closingSelector) {\n    this.closingSelector = closingSelector;\n  }\n\n  BufferWhenOperator.prototype.call = function (subscriber, source) {\n    return source.subscribe(new BufferWhenSubscriber(subscriber, this.closingSelector));\n  };\n\n  return BufferWhenOperator;\n}();\n\nvar BufferWhenSubscriber = /*@__PURE__*/function (_super) {\n  tslib_1.__extends(BufferWhenSubscriber, _super);\n\n  function BufferWhenSubscriber(destination, closingSelector) {\n    var _this = _super.call(this, destination) || this;\n\n    _this.closingSelector = closingSelector;\n    _this.subscribing = false;\n\n    _this.openBuffer();\n\n    return _this;\n  }\n\n  BufferWhenSubscriber.prototype._next = function (value) {\n    this.buffer.push(value);\n  };\n\n  BufferWhenSubscriber.prototype._complete = function () {\n    var buffer = this.buffer;\n\n    if (buffer) {\n      this.destination.next(buffer);\n    }\n\n    _super.prototype._complete.call(this);\n  };\n\n  BufferWhenSubscriber.prototype._unsubscribe = function () {\n    this.buffer = undefined;\n    this.subscribing = false;\n  };\n\n  BufferWhenSubscriber.prototype.notifyNext = function () {\n    this.openBuffer();\n  };\n\n  BufferWhenSubscriber.prototype.notifyComplete = function () {\n    if (this.subscribing) {\n      this.complete();\n    } else {\n      this.openBuffer();\n    }\n  };\n\n  BufferWhenSubscriber.prototype.openBuffer = function () {\n    var closingSubscription = this.closingSubscription;\n\n    if (closingSubscription) {\n      this.remove(closingSubscription);\n      closingSubscription.unsubscribe();\n    }\n\n    var buffer = this.buffer;\n\n    if (this.buffer) {\n      this.destination.next(buffer);\n    }\n\n    this.buffer = [];\n    var closingNotifier;\n\n    try {\n      var closingSelector = this.closingSelector;\n      closingNotifier = closingSelector();\n    } catch (err) {\n      return this.error(err);\n    }\n\n    closingSubscription = new Subscription();\n    this.closingSubscription = closingSubscription;\n    this.add(closingSubscription);\n    this.subscribing = true;\n    closingSubscription.add(innerSubscribe(closingNotifier, new SimpleInnerSubscriber(this)));\n    this.subscribing = false;\n  };\n\n  return BufferWhenSubscriber;\n}(SimpleOuterSubscriber);","map":{"version":3,"sources":["../../../src/internal/operators/bufferWhen.ts"],"names":[],"mappings":"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","sourcesContent":["/** PURE_IMPORTS_START tslib,_Subscription,_innerSubscribe PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subscription } from '../Subscription';\nimport { SimpleOuterSubscriber, innerSubscribe, SimpleInnerSubscriber } from '../innerSubscribe';\nexport function bufferWhen(closingSelector) {\n    return function (source) {\n        return source.lift(new BufferWhenOperator(closingSelector));\n    };\n}\nvar BufferWhenOperator = /*@__PURE__*/ (function () {\n    function BufferWhenOperator(closingSelector) {\n        this.closingSelector = closingSelector;\n    }\n    BufferWhenOperator.prototype.call = function (subscriber, source) {\n        return source.subscribe(new BufferWhenSubscriber(subscriber, this.closingSelector));\n    };\n    return BufferWhenOperator;\n}());\nvar BufferWhenSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(BufferWhenSubscriber, _super);\n    function BufferWhenSubscriber(destination, closingSelector) {\n        var _this = _super.call(this, destination) || this;\n        _this.closingSelector = closingSelector;\n        _this.subscribing = false;\n        _this.openBuffer();\n        return _this;\n    }\n    BufferWhenSubscriber.prototype._next = function (value) {\n        this.buffer.push(value);\n    };\n    BufferWhenSubscriber.prototype._complete = function () {\n        var buffer = this.buffer;\n        if (buffer) {\n            this.destination.next(buffer);\n        }\n        _super.prototype._complete.call(this);\n    };\n    BufferWhenSubscriber.prototype._unsubscribe = function () {\n        this.buffer = undefined;\n        this.subscribing = false;\n    };\n    BufferWhenSubscriber.prototype.notifyNext = function () {\n        this.openBuffer();\n    };\n    BufferWhenSubscriber.prototype.notifyComplete = function () {\n        if (this.subscribing) {\n            this.complete();\n        }\n        else {\n            this.openBuffer();\n        }\n    };\n    BufferWhenSubscriber.prototype.openBuffer = function () {\n        var closingSubscription = this.closingSubscription;\n        if (closingSubscription) {\n            this.remove(closingSubscription);\n            closingSubscription.unsubscribe();\n        }\n        var buffer = this.buffer;\n        if (this.buffer) {\n            this.destination.next(buffer);\n        }\n        this.buffer = [];\n        var closingNotifier;\n        try {\n            var closingSelector = this.closingSelector;\n            closingNotifier = closingSelector();\n        }\n        catch (err) {\n            return this.error(err);\n        }\n        closingSubscription = new Subscription();\n        this.closingSubscription = closingSubscription;\n        this.add(closingSubscription);\n        this.subscribing = true;\n        closingSubscription.add(innerSubscribe(closingNotifier, new SimpleInnerSubscriber(this)));\n        this.subscribing = false;\n    };\n    return BufferWhenSubscriber;\n}(SimpleOuterSubscriber));\n//# sourceMappingURL=bufferWhen.js.map\n"]},"metadata":{},"sourceType":"module"}